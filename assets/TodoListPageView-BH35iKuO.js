import{o as m,c as f,F as G,j as I,b as E,a as s,w as M,k as R,l as d,t as L,r as a,m as j,f as h,n as F,g as K,d as S,e as V,v as H,p as J,q as y,h as Q,i as W}from"./index-pKOWNh4-.js";const X={key:0,class:"todoList_item"},Y={class:"todoList_label"},Z=["onUpdate:modelValue","onChange"],ee=["onClick"],te=s("i",{class:"fa-solid fa-pen-to-square"},null,-1),se=[te],ae=["onClick"],oe=s("i",{class:"fa-solid fa-trash"},null,-1),ne=[oe],le={__name:"TodoList",props:["list-todos"],emits:["emit-edit","emit-del","emit-patch"],setup(b,{emit:C}){const v=C;return(o,w)=>o.listTodos?(m(),f("ul",X,[(m(!0),f(G,null,I(o.listTodos,u=>(m(),f("li",{key:u.id},[s("label",Y,[M(s("input",{class:"todoList_input","onUpdate:modelValue":n=>u.status=n,type:"checkbox",value:"true",onChange:d(n=>v("emit-patch",u),["prevent"])},null,40,Z),[[R,u.status]]),s("span",null,L(u.content),1)]),s("a",{href:"#",onClick:d(n=>v("emit-edit",u),["prevent"]),title:"編輯"},se,8,ee),s("a",{href:"#",onClick:d(n=>v("emit-del",u),["prevent"]),title:"刪除"},ne,8,ae)]))),128))])):E("",!0)}},ie={id:"todoListPage",class:"bg-half"},ue={class:"todo_sm"},re={class:"conatiner todoListPage vhContainer"},de={class:"todoList_Content"},ce={class:"inputBox"},ve={class:"errorMsg"},pe={class:"todoList_list"},he={class:"todoList_tab"},_e={class:"todoList_items"},me={key:0},fe={key:1,class:"todoList_statistics"},_="https://todolist-api.hexschool.io/",z="hexschooltoken",ge={__name:"TodoListPageView",setup(b){const C=a(""),v=a("");j(async()=>{await u()});const o=a(""),w=a(""),u=async()=>{try{const e=document.cookie;if(e!=""&&e.split("=")[0]==z){o.value=e.split("=")[1];const t=await h.get(`${_}users/checkout`,{headers:{Authorization:o.value}});t.data.status&&(v.value=t.data.token,C.value=t.data.nickname,w.value="驗證成功",g())}else alert("尚未取得Token"),N()}catch(e){e.response.data!=""&&(w.value="驗證失敗:"+e.response.data.message)}},n=a(""),k=a([]),c=a([]),p=a(0),T=e=>{c.value=k.value,p.value=e,e>0&&(c.value=k.value.filter(t=>t.status==(e==2)))},g=async()=>{try{const e=await h.get(`${_}todos`,{headers:{Authorization:o.value}});e.data.status&&(c.value=k.value=e.data.data,T(p.value))}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},q=F(()=>c.value.sort((e,t)=>new Date(t.createTime)-new Date(e.createTime))),x=a(!1),l=a({content:""}),P=async()=>{try{p.value=0;const e=a(!0);x.value=!1,Object.values(l.value).every(i=>i!=="")||(e.value=!1,x.value=!0,alert("請輸入代辦事項")),o.value==""&&(x.value=!1,alert("尚未取得Token")),e.value&&(console.log("add",l.value),(await h.post(`${_}todos`,l.value,{headers:{Authorization:o.value}})).data.status&&(l.value={...l},g()))}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},$=a(!0),D=a(0),B=e=>{const t={...e};l.value.content=t.content,D.value=t.id,$.value=!1},A=async()=>{try{const e=await h.put(`${_}todos/${D.value}`,l.value,{headers:{Authorization:o.value}});e.data.status&&($.value=!0,l.value={...l},alert(`${e.data.message}`),g())}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},O=async e=>{try{const t={...e},i=await h.delete(`${_}todos/${t.id}`,{headers:{Authorization:o.value}});i.data.status&&(alert(`${i.data.message}`),g())}catch(t){t.response.data!=""&&(n.value="驗證失敗:"+t.response.data.message)}},U=async e=>{try{const t={...e},i=await h.patch(`${_}todos/${t.id}/toggle`,{},{headers:{Authorization:o.value}});i.data.status&&(alert(`${i.data.message}`),g())}catch(t){t.response.data!=""&&(n.value="驗證失敗:"+t.response.data.message)}},N=()=>{k.value=[],c.value=[],o.value="",document.cookie=`${z}=${v.value}; max-age=-1`,K.push("/")};return(e,t)=>{const i=Q("RouterLink");return m(),f("div",ie,[s("nav",null,[s("h1",null,[S(i,{to:"/Todo"},{default:V(()=>[W("ONLINE TODO LIST ")]),_:1})]),s("ul",null,[s("li",ue,[S(i,{to:"/Todo"},{default:V(()=>[s("span",null,L(C.value)+" 的代辦",1)]),_:1})]),s("li",null,[s("a",{href:"#",onClick:t[0]||(t[0]=d(r=>N(),["prevent"]))},"登出")])])]),s("div",re,[s("div",de,[s("div",ce,[M(s("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[1]||(t[1]=r=>l.value.content=r),onKeyup:t[2]||(t[2]=J(r=>$.value?P():A(),["enter"]))},null,544),[[H,l.value.content]]),s("a",{href:"#",onClick:t[3]||(t[3]=d(r=>$.value?P():A(),["prevent"]))},[s("i",{class:y($.value?"fa fa-plus":"fa-solid fa-pen-to-square")},null,2)])]),s("span",ve,L(n.value),1),s("div",pe,[s("ul",he,[s("li",null,[s("a",{href:"#",class:y(p.value==0?"active":""),onClick:t[4]||(t[4]=d(r=>T(0),["prevent"]))},"全部",2)]),s("li",null,[s("a",{href:"#",class:y(p.value==1?"active":""),onClick:t[5]||(t[5]=d(r=>T(1),["prevent"]))},"待完成",2)]),s("li",null,[s("a",{href:"#",class:y(p.value==2?"active":""),onClick:t[6]||(t[6]=d(r=>T(2),["prevent"]))},"已完成",2)])]),s("div",_e,[!c.value.length>0?(m(),f("span",me,"「目前尚無待辦事項」")):E("",!0),S(le,{"list-todos":q.value,onEmitEdit:B,onEmitDel:O,onEmitPatch:U},null,8,["list-todos"]),c.value.length>0?(m(),f("div",fe,[s("p",null,L(k.value.filter(r=>r.status==!0).length)+" 個已完成項目",1)])):E("",!0)])])])])])}}};export{ge as default};
