import{r as n,i as q,f as c,j as B,k as O,c as v,a as s,d as U,e as I,l as r,w as A,v as R,m as G,n as j,t as g,b as T,F,p as K,g as H,o as h,q as J}from"./index-8TVy06T7.js";const Q={id:"todoListPage",class:"bg-half"},W=s("h1",null,[s("a",{href:"#"},"ONLINE TODO LIST")],-1),X={class:"todo_sm"},Y={class:"conatiner todoListPage vhContainer"},Z={class:"todoList_Content"},ee={class:"inputBox"},te={class:"errorMsg"},se={class:"todoList_list"},ae={class:"todoList_tab"},oe={class:"todoList_items"},ne={key:0},le={key:1,class:"todoList_item"},ie={class:"todoList_label"},ue=["onUpdate:modelValue","onChange"],re=["onClick"],de=s("i",{class:"fa-solid fa-pen-to-square"},null,-1),ce=[de],ve=["onClick"],he=s("i",{class:"fa-solid fa-trash"},null,-1),pe=[he],fe={key:2,class:"todoList_statistics"},p="https://todolist-api.hexschool.io/",V="hexschooltoken",ke={__name:"TodoListPageView",setup(_e){const L=n(""),$=n("");q(async()=>{await b()});const i=n(""),w=n(""),b=async()=>{try{const e=document.cookie;if(e!=""&&e.split("=")[0]==V){i.value=e.split("=")[1];const t=await c.get(`${p}users/checkout`,{headers:{Authorization:i.value}});t.data.status&&($.value=t.data.token,L.value=t.data.nickname,w.value="驗證成功",_())}else alert("尚未取得Token"),D()}catch(e){e.response.data!=""&&(w.value="驗證失敗:"+e.response.data.message)}},d=n(""),f=n([]),u=n([]),C=e=>{u.value=f.value,typeof e<"u"&&(u.value=f.value.filter(t=>t.status==e))},_=async()=>{try{const e=await c.get(`${p}todos`,{headers:{Authorization:i.value}});e.data.status&&(u.value=f.value=e.data.data)}catch(e){e.response.data!=""&&(d.value="驗證失敗:"+e.response.data.message)}},z=B(()=>u.value.sort((e,t)=>new Date(t.createTime)-new Date(e.createTime))),y=n(!1),o=n({content:""}),x=async()=>{try{const e=n(!0);y.value=!1,Object.values(o.value).every(l=>l!=="")||(e.value=!1,y.value=!0,alert("請輸入代辦事項")),i.value==""&&(y.value=!1,alert("尚未取得Token")),e.value&&(await c.post(`${p}todos`,o.value,{headers:{Authorization:i.value}})).data.status&&(o.value={...o},_())}catch(e){e.response.data!=""&&(d.value="驗證失敗:"+e.response.data.message)}},m=n(!0),S=n(0),E=e=>{const t={...e};o.value.content=t.content,S.value=t.id,m.value=!1},P=async()=>{try{const e=await c.put(`${p}todos/${S.value}`,o.value,{headers:{Authorization:i.value}});e.data.status&&(m.value=!0,o.value={...o},alert(`${e.data.message}`),_())}catch(e){e.response.data!=""&&(d.value="驗證失敗:"+e.response.data.message)}},M=async e=>{try{const t={...e},l=await c.delete(`${p}todos/${t.id}`,{headers:{Authorization:i.value}});l.data.status&&(alert(`${l.data.message}`),_())}catch(t){t.response.data!=""&&(d.value="驗證失敗:"+t.response.data.message)}},N=async e=>{try{const t={...e},l=await c.patch(`${p}todos/${t.id}/toggle`,{},{headers:{Authorization:i.value}});l.data.status&&(o.value={...o},alert(`${l.data.message}`),_())}catch(t){t.response.data!=""&&(d.value="驗證失敗:"+t.response.data.message)}},D=()=>{f.value=[],u.value=[],i.value="",document.cookie=`${V}=${$.value}; max-age=-1`,O.push("/")};return(e,t)=>{const l=H("RouterLink");return h(),v("div",Q,[s("nav",null,[W,s("ul",null,[s("li",X,[U(l,{to:"/TodoListPageView"},{default:I(()=>[s("span",null,g(L.value)+" 的代辦",1)]),_:1})]),s("li",null,[s("a",{href:"#",onClick:t[0]||(t[0]=r(a=>D(),["prevent"]))},"登出")])])]),s("div",Y,[s("div",Z,[s("div",ee,[A(s("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[1]||(t[1]=a=>o.value.content=a),onKeyup:t[2]||(t[2]=G(a=>m.value?x():P(),["enter"]))},null,544),[[R,o.value.content]]),s("a",{href:"#",onClick:t[3]||(t[3]=r(a=>m.value?x():P(),["prevent"]))},[s("i",{class:j(m.value?"fa fa-plus":"fa-solid fa-pen-to-square")},null,2)])]),s("span",te,g(d.value),1),s("div",se,[s("ul",ae,[s("li",null,[s("a",{href:"#",class:"active",onClick:t[4]||(t[4]=r(a=>C(),["prevent"]))},"全部")]),s("li",null,[s("a",{href:"#",onClick:t[5]||(t[5]=r(a=>C(!1),["prevent"]))},"待完成")]),s("li",null,[s("a",{href:"#",onClick:t[6]||(t[6]=r(a=>C(!0),["prevent"]))},"已完成")])]),s("div",oe,[!u.value.length>0?(h(),v("span",ne,"「目前尚無待辦事項」")):T("",!0),u.value.length>0?(h(),v("ul",le,[(h(!0),v(F,null,K(z.value,a=>(h(),v("li",{key:a.id},[s("label",ie,[A(s("input",{class:"todoList_input","onUpdate:modelValue":k=>a.status=k,type:"checkbox",value:"true",onChange:r(k=>N(a),["prevent"])},null,40,ue),[[J,a.status]]),s("span",null,g(a.content),1)]),s("a",{href:"#",onClick:r(k=>E(a),["prevent"]),title:"編輯"},ce,8,re),s("a",{href:"#",onClick:r(k=>M(a),["prevent"]),title:"刪除"},pe,8,ve)]))),128))])):T("",!0),u.value.length>0?(h(),v("div",fe,[s("p",null,g(f.value.filter(a=>a.status==!0).length)+" 個已完成項目",1)])):T("",!0)])])])])])}}};export{ke as default};
