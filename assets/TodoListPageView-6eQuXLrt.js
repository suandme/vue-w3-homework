import{o as p,c as h,F as U,i as G,b as D,a as s,w as b,j as I,k as d,t as L,r as o,l as R,f as k,m as j,n as F,d as x,e as A,v as K,p as H,q as y,g as J,h as Q}from"./index-DBYuIlRh.js";const W={key:0,class:"todoList_item"},X={class:"todoList_label"},Y=["onUpdate:modelValue","onChange"],Z=["onClick"],ee=s("i",{class:"fa-solid fa-pen-to-square"},null,-1),te=[ee],se=["onClick"],oe=s("i",{class:"fa-solid fa-trash"},null,-1),ae=[oe],ne={__name:"TodoList",props:["list-todos"],emits:["emit-edit","emit-del"],setup(z,{emit:$}){const _=$;return(a,w)=>a.listTodos?(p(),h("ul",W,[(p(!0),h(U,null,G(a.listTodos,i=>(p(),h("li",{key:i.id},[s("label",X,[b(s("input",{class:"todoList_input","onUpdate:modelValue":n=>i.status=n,type:"checkbox",value:"true",onChange:d(n=>a.PatchTodosContenSend(i),["prevent"])},null,40,Y),[[I,i.status]]),s("span",null,L(i.content),1)]),s("a",{href:"#",onClick:d(n=>_("emitEdit",i),["prevent"]),title:"編輯"},te,8,Z),s("a",{href:"#",onClick:d(n=>_("emitDel",i),["prevent"]),title:"刪除"},ae,8,se)]))),128))])):D("",!0)}},le={id:"todoListPage",class:"bg-half"},ie={class:"todo_sm"},ue={class:"conatiner todoListPage vhContainer"},re={class:"todoList_Content"},de={class:"inputBox"},ce={class:"errorMsg"},ve={class:"todoList_list"},pe={class:"todoList_tab"},he={class:"todoList_items"},_e={key:0},fe={key:1,class:"todoList_statistics"},C="https://todolist-api.hexschool.io/",M="hexschooltoken",ke={__name:"TodoListPageView",setup(z){const $=o(""),_=o("");R(async()=>{await i()});const a=o(""),w=o(""),i=async()=>{try{const e=document.cookie;if(e!=""&&e.split("=")[0]==M){a.value=e.split("=")[1];const t=await k.get(`${C}users/checkout`,{headers:{Authorization:a.value}});t.data.status&&(_.value=t.data.token,$.value=t.data.nickname,w.value="驗證成功",g())}else alert("尚未取得Token"),V()}catch(e){e.response.data!=""&&(w.value="驗證失敗:"+e.response.data.message)}},n=o(""),f=o([]),c=o([]),v=o(0),T=e=>{c.value=f.value,v.value=e,e>0&&(c.value=f.value.filter(t=>t.status==(e==2)))},g=async()=>{try{const e=await k.get(`${C}todos`,{headers:{Authorization:a.value}});e.data.status&&(c.value=f.value=e.data.data,T(v.value))}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},q=j(()=>c.value.sort((e,t)=>new Date(t.createTime)-new Date(e.createTime))),S=o(!1),l=o({content:""}),E=async()=>{try{v.value=0;const e=o(!0);S.value=!1,Object.values(l.value).every(r=>r!=="")||(e.value=!1,S.value=!0,alert("請輸入代辦事項")),a.value==""&&(S.value=!1,alert("尚未取得Token")),e.value&&(await k.post(`${C}todos`,l.value,{headers:{Authorization:a.value}})).data.status&&(l.value={...l},g())}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},m=o(!0),P=o(0),B=e=>{const t={...e};l.value.content=t.content,P.value=t.id,m.value=!1},N=async()=>{try{const e=await k.put(`${C}todos/${P.value}`,l.value,{headers:{Authorization:a.value}});e.data.status&&(m.value=!0,l.value={...l},alert(`${e.data.message}`),g())}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},O=async e=>{try{const t={...e},r=await k.delete(`${C}todos/${t.id}`,{headers:{Authorization:a.value}});r.data.status&&(alert(`${r.data.message}`),g())}catch(t){t.response.data!=""&&(n.value="驗證失敗:"+t.response.data.message)}},V=()=>{f.value=[],c.value=[],a.value="",document.cookie=`${M}=${_.value}; max-age=-1`,F.push("/")};return(e,t)=>{const r=J("RouterLink");return p(),h("div",le,[s("nav",null,[s("h1",null,[x(r,{to:"/Todo"},{default:A(()=>[Q("ONLINE TODO LIST ")]),_:1})]),s("ul",null,[s("li",ie,[x(r,{to:"/Todo"},{default:A(()=>[s("span",null,L($.value)+" 的代辦",1)]),_:1})]),s("li",null,[s("a",{href:"#",onClick:t[0]||(t[0]=d(u=>V(),["prevent"]))},"登出")])])]),s("div",ue,[s("div",re,[s("div",de,[b(s("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[1]||(t[1]=u=>l.value.content=u),onKeyup:t[2]||(t[2]=H(u=>m.value?E():N(),["enter"]))},null,544),[[K,l.value.content]]),s("a",{href:"#",onClick:t[3]||(t[3]=d(u=>m.value?E():N(),["prevent"]))},[s("i",{class:y(m.value?"fa fa-plus":"fa-solid fa-pen-to-square")},null,2)])]),s("span",ce,L(n.value),1),s("div",ve,[s("ul",pe,[s("li",null,[s("a",{href:"#",class:y(v.value==0?"active":""),onClick:t[4]||(t[4]=d(u=>T(0),["prevent"]))},"全部",2)]),s("li",null,[s("a",{href:"#",class:y(v.value==1?"active":""),onClick:t[5]||(t[5]=d(u=>T(1),["prevent"]))},"待完成",2)]),s("li",null,[s("a",{href:"#",class:y(v.value==2?"active":""),onClick:t[6]||(t[6]=d(u=>T(2),["prevent"]))},"已完成",2)])]),s("div",he,[!c.value.length>0?(p(),h("span",_e,"「目前尚無待辦事項」")):D("",!0),x(ne,{"list-todos":q.value,onEmitEdit:B,onEmitDel:O},null,8,["list-todos"]),c.value.length>0?(p(),h("div",fe,[s("p",null,L(f.value.filter(u=>u.status==!0).length)+" 個已完成項目",1)])):D("",!0)])])])])])}}};export{ke as default};
