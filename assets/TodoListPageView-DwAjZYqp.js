import{o as v,c as p,F as O,i as U,b as D,a as t,w as V,j as G,k as r,t as y,r as o,l as I,f as k,m as R,n as j,d as M,e as F,v as K,p as H,q as T,g as J}from"./index-DU7Tc6C7.js";const Q={key:0,class:"todoList_item"},W={class:"todoList_label"},X=["onUpdate:modelValue","onChange"],Y=["onClick"],Z=t("i",{class:"fa-solid fa-pen-to-square"},null,-1),ee=[Z],te=["onClick"],se=t("i",{class:"fa-solid fa-trash"},null,-1),oe=[se],ae={__name:"TodoList",props:["list-todos"],emits:["emit-edit","emit-del"],setup(b,{emit:$}){const h=$;return(a,L)=>a.listTodos?(v(),p("ul",Q,[(v(!0),p(O,null,U(a.listTodos,i=>(v(),p("li",{key:i.id},[t("label",W,[V(t("input",{class:"todoList_input","onUpdate:modelValue":n=>i.status=n,type:"checkbox",value:"true",onChange:r(n=>a.PatchTodosContenSend(i),["prevent"])},null,40,X),[[G,i.status]]),t("span",null,y(i.content),1)]),t("a",{href:"#",onClick:r(n=>h("emitEdit",i),["prevent"]),title:"編輯"},ee,8,Y),t("a",{href:"#",onClick:r(n=>h("emitDel",i),["prevent"]),title:"刪除"},oe,8,te)]))),128))])):D("",!0)}},ne={id:"todoListPage",class:"bg-half"},le=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1),ie={class:"todo_sm"},ue={class:"conatiner todoListPage vhContainer"},re={class:"todoList_Content"},de={class:"inputBox"},ce={class:"errorMsg"},ve={class:"todoList_list"},pe={class:"todoList_tab"},he={class:"todoList_items"},_e={key:0},fe={key:1,class:"todoList_statistics"},C="https://todolist-api.hexschool.io/",N="hexschooltoken",ke={__name:"TodoListPageView",setup(b){const $=o(""),h=o("");I(async()=>{await i()});const a=o(""),L=o(""),i=async()=>{try{const e=document.cookie;if(e!=""&&e.split("=")[0]==N){a.value=e.split("=")[1];const s=await k.get(`${C}users/checkout`,{headers:{Authorization:a.value}});s.data.status&&(h.value=s.data.token,$.value=s.data.nickname,L.value="驗證成功",g())}else alert("尚未取得Token"),A()}catch(e){e.response.data!=""&&(L.value="驗證失敗:"+e.response.data.message)}},n=o(""),_=o([]),d=o([]),f=o(0),w=e=>{d.value=_.value,f.value=e,e>0&&(d.value=_.value.filter(s=>s.status==(e==2)))},g=async()=>{try{const e=await k.get(`${C}todos`,{headers:{Authorization:a.value}});e.data.status&&(d.value=_.value=e.data.data)}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},z=R(()=>d.value.sort((e,s)=>new Date(s.createTime)-new Date(e.createTime))),S=o(!1),l=o({content:""}),x=async()=>{try{f.value=0;const e=o(!0);S.value=!1,Object.values(l.value).every(c=>c!=="")||(e.value=!1,S.value=!0,alert("請輸入代辦事項")),a.value==""&&(S.value=!1,alert("尚未取得Token")),e.value&&(await k.post(`${C}todos`,l.value,{headers:{Authorization:a.value}})).data.status&&(l.value={...l.value},g())}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},m=o(!0),E=o(0),q=e=>{const s={...e};l.value.content=s.content,E.value=s.id,m.value=!1},P=async()=>{try{const e=await k.put(`${C}todos/${E.value}`,l.value,{headers:{Authorization:a.value}});e.data.status&&(m.value=!0,l.value={...l},alert(`${e.data.message}`),g())}catch(e){e.response.data!=""&&(n.value="驗證失敗:"+e.response.data.message)}},B=async e=>{try{const s={...e},c=await k.delete(`${C}todos/${s.id}`,{headers:{Authorization:a.value}});c.data.status&&(alert(`${c.data.message}`),g())}catch(s){s.response.data!=""&&(n.value="驗證失敗:"+s.response.data.message)}},A=()=>{_.value=[],d.value=[],a.value="",document.cookie=`${N}=${h.value}; max-age=-1`,j.push("/")};return(e,s)=>{const c=J("RouterLink");return v(),p("div",ne,[t("nav",null,[le,t("ul",null,[t("li",ie,[M(c,{to:"/Todo"},{default:F(()=>[t("span",null,y($.value)+" 的代辦",1)]),_:1})]),t("li",null,[t("a",{href:"#",onClick:s[0]||(s[0]=r(u=>A(),["prevent"]))},"登出")])])]),t("div",ue,[t("div",re,[t("div",de,[V(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[1]||(s[1]=u=>l.value.content=u),onKeyup:s[2]||(s[2]=H(u=>m.value?x():P(),["enter"]))},null,544),[[K,l.value.content]]),t("a",{href:"#",onClick:s[3]||(s[3]=r(u=>m.value?x():P(),["prevent"]))},[t("i",{class:T(m.value?"fa fa-plus":"fa-solid fa-pen-to-square")},null,2)])]),t("span",ce,y(n.value),1),t("div",ve,[t("ul",pe,[t("li",null,[t("a",{href:"#",class:T(f.value==0?"active":""),onClick:s[4]||(s[4]=r(u=>w(0),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:T(f.value==1?"active":""),onClick:s[5]||(s[5]=r(u=>w(1),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:T(f.value==2?"active":""),onClick:s[6]||(s[6]=r(u=>w(2),["prevent"]))},"已完成",2)])]),t("div",he,[!d.value.length>0?(v(),p("span",_e,"「目前尚無待辦事項」")):D("",!0),M(ae,{"list-todos":z.value,onEmitEdit:q,onEmitDel:B},null,8,["list-todos"]),d.value.length>0?(v(),p("div",fe,[t("p",null,y(_.value.filter(u=>u.status==!0).length)+" 個已完成項目",1)])):D("",!0)])])])])])}}};export{ke as default};
